Ground this clinical trial criterion:

Criterion: {{ criterion_text }}
Type: {{ criterion_type }}
Budget: {{ recursion_limit }} steps (stop early if complete)

{% if triplet %}
MedGemma triplet (already extracted):
- Entity: {{ triplet.entity or "N/A" }}
- Relation: {{ triplet.relation or "N/A" }}
- Value: {{ triplet.value or "N/A" }}
- Unit: {{ triplet.unit or "N/A" }}
{% endif %}

**IMPORTANT: Only ground clinically relevant terms for patient matching:**
- Medical diagnoses, lab values, medications, procedures, demographics
- Skip administrative terms (consent, guardian, criterion, protocol)

For age criteria, map to "Date of birth" with computed_as: "floor((today - birthDate) / 365.25)"

Follow this workflow:
1. Use the provided MedGemma triplet when available (do NOT call interpret_medical_text)
2. Identify the all the medically relevant concepts for each criterion and call search_concepts (limit=1 per concept) to find the best UMLS match
3. Call get_semantic_type ONLY if needed to determine field categories
4. Map semantic types to field categories
5. Extract relations (>, >=, <, <=, =, within, IS, IS NOT, AND, OR) and values from the criterion text
6. If the criterion implies a computed field (e.g., age), include a computed_as expression:
   - Example: "Age >= 18 years" -> concept "Date of birth", computed_as "floor((today - birthDate) / 365.25)"
7. Always attempt to ground demographic or lab terms to a SNOMED concept via UMLS (only clinically relevant terms)

Return a structured GroundingResult with:
- terms: List of grounded terms (snippet, umls_concept, umls_id, snomed_code, relation, value, unit, computed_as, confidence)
- logical_operator: AND/OR between terms when multiple conditions exist
- reasoning: Brief explanation of your analysis and tool usage

---

## Important: Minimize tool interactions
- First, rely on the provided triplet (if available)
- Then search for the relevant medical cconcepts per criterion (limit=1 per concept)
- Return the GroundingResult as soon as you have the essential data
- Do NOT call tools again to "refine" or "verify" results
